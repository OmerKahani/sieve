{"pod": [{"metadata": {"name": "rabbitmq-cluster-server-0", "generateName": "rabbitmq-cluster-server-", "namespace": "default", "selfLink": "/api/v1/namespaces/default/pods/rabbitmq-cluster-server-0", "uid": "e4ad640a-df2d-4495-8ecb-8748cd0d1fea", "resourceVersion": "1383", "creationTimestamp": "2021-08-01T10:19:21Z", "labels": {"app.kubernetes.io/component": "rabbitmq", "app.kubernetes.io/name": "rabbitmq-cluster", "app.kubernetes.io/part-of": "rabbitmq", "controller-revision-hash": "rabbitmq-cluster-server-5f8b8665fb", "statefulset.kubernetes.io/pod-name": "rabbitmq-cluster-server-0"}, "annotations": {"prometheus.io/port": "15692", "prometheus.io/scrape": "true"}, "ownerReferences": [{"apiVersion": "apps/v1", "kind": "StatefulSet", "name": "rabbitmq-cluster-server", "uid": "757c5705-804d-4916-b633-1a1555612182", "controller": true, "blockOwnerDeletion": true}], "managedFields": [{"manager": "kube-controller-manager", "operation": "Update", "apiVersion": "v1", "time": "2021-08-01T10:19:21Z", "fieldsType": "FieldsV1", "fieldsV1": {"f:metadata": {"f:annotations": {".": {}, "f:prometheus.io/port": {}, "f:prometheus.io/scrape": {}}, "f:generateName": {}, "f:labels": {".": {}, "f:app.kubernetes.io/component": {}, "f:app.kubernetes.io/name": {}, "f:app.kubernetes.io/part-of": {}, "f:controller-revision-hash": {}, "f:statefulset.kubernetes.io/pod-name": {}}, "f:ownerReferences": {".": {}, "k:{\"uid\":\"757c5705-804d-4916-b633-1a1555612182\"}": {".": {}, "f:apiVersion": {}, "f:blockOwnerDeletion": {}, "f:controller": {}, "f:kind": {}, "f:name": {}, "f:uid": {}}}}, "f:spec": {"f:automountServiceAccountToken": {}, "f:containers": {"k:{\"name\":\"rabbitmq\"}": {".": {}, "f:env": {".": {}, "k:{\"name\":\"K8S_HOSTNAME_SUFFIX\"}": {".": {}, "f:name": {}, "f:value": {}}, "k:{\"name\":\"K8S_SERVICE_NAME\"}": {".": {}, "f:name": {}, "f:value": {}}, "k:{\"name\":\"MY_POD_NAME\"}": {".": {}, "f:name": {}, "f:valueFrom": {".": {}, "f:fieldRef": {".": {}, "f:apiVersion": {}, "f:fieldPath": {}}}}, "k:{\"name\":\"MY_POD_NAMESPACE\"}": {".": {}, "f:name": {}, "f:valueFrom": {".": {}, "f:fieldRef": {".": {}, "f:apiVersion": {}, "f:fieldPath": {}}}}, "k:{\"name\":\"RABBITMQ_ENABLED_PLUGINS_FILE\"}": {".": {}, "f:name": {}, "f:value": {}}, "k:{\"name\":\"RABBITMQ_NODENAME\"}": {".": {}, "f:name": {}, "f:value": {}}, "k:{\"name\":\"RABBITMQ_USE_LONGNAME\"}": {".": {}, "f:name": {}, "f:value": {}}}, "f:image": {}, "f:imagePullPolicy": {}, "f:lifecycle": {".": {}, "f:preStop": {".": {}, "f:exec": {".": {}, "f:command": {}}}}, "f:name": {}, "f:ports": {".": {}, "k:{\"containerPort\":4369,\"protocol\":\"TCP\"}": {".": {}, "f:containerPort": {}, "f:name": {}, "f:protocol": {}}, "k:{\"containerPort\":5672,\"protocol\":\"TCP\"}": {".": {}, "f:containerPort": {}, "f:name": {}, "f:protocol": {}}, "k:{\"containerPort\":15672,\"protocol\":\"TCP\"}": {".": {}, "f:containerPort": {}, "f:name": {}, "f:protocol": {}}, "k:{\"containerPort\":15692,\"protocol\":\"TCP\"}": {".": {}, "f:containerPort": {}, "f:name": {}, "f:protocol": {}}}, "f:readinessProbe": {".": {}, "f:failureThreshold": {}, "f:initialDelaySeconds": {}, "f:periodSeconds": {}, "f:successThreshold": {}, "f:tcpSocket": {".": {}, "f:port": {}}, "f:timeoutSeconds": {}}, "f:resources": {".": {}, "f:limits": {".": {}, "f:cpu": {}, "f:memory": {}}, "f:requests": {".": {}, "f:cpu": {}, "f:memory": {}}}, "f:terminationMessagePath": {}, "f:terminationMessagePolicy": {}, "f:volumeMounts": {".": {}, "k:{\"mountPath\":\"/etc/pod-info/\"}": {".": {}, "f:mountPath": {}, "f:name": {}}, "k:{\"mountPath\":\"/etc/rabbitmq/conf.d/10-operatorDefaults.conf\"}": {".": {}, "f:mountPath": {}, "f:name": {}, "f:subPath": {}}, "k:{\"mountPath\":\"/etc/rabbitmq/conf.d/11-default_user.conf\"}": {".": {}, "f:mountPath": {}, "f:name": {}, "f:subPath": {}}, "k:{\"mountPath\":\"/etc/rabbitmq/conf.d/90-userDefinedConfiguration.conf\"}": {".": {}, "f:mountPath": {}, "f:name": {}, "f:subPath": {}}, "k:{\"mountPath\":\"/operator\"}": {".": {}, "f:mountPath": {}, "f:name": {}}, "k:{\"mountPath\":\"/var/lib/rabbitmq/\"}": {".": {}, "f:mountPath": {}, "f:name": {}}, "k:{\"mountPath\":\"/var/lib/rabbitmq/mnesia/\"}": {".": {}, "f:mountPath": {}, "f:name": {}}}}}, "f:dnsPolicy": {}, "f:enableServiceLinks": {}, "f:hostname": {}, "f:initContainers": {".": {}, "k:{\"name\":\"setup-container\"}": {".": {}, "f:command": {}, "f:image": {}, "f:imagePullPolicy": {}, "f:name": {}, "f:resources": {".": {}, "f:limits": {".": {}, "f:cpu": {}, "f:memory": {}}, "f:requests": {".": {}, "f:cpu": {}, "f:memory": {}}}, "f:securityContext": {".": {}, "f:capabilities": {".": {}, "f:drop": {}}, "f:runAsUser": {}}, "f:terminationMessagePath": {}, "f:terminationMessagePolicy": {}, "f:volumeMounts": {".": {}, "k:{\"mountPath\":\"/operator\"}": {".": {}, "f:mountPath": {}, "f:name": {}}, "k:{\"mountPath\":\"/tmp/default_user.conf\"}": {".": {}, "f:mountPath": {}, "f:name": {}, "f:subPath": {}}, "k:{\"mountPath\":\"/tmp/erlang-cookie-secret/\"}": {".": {}, "f:mountPath": {}, "f:name": {}}, "k:{\"mountPath\":\"/tmp/rabbitmq-plugins/\"}": {".": {}, "f:mountPath": {}, "f:name": {}}, "k:{\"mountPath\":\"/var/lib/rabbitmq/\"}": {".": {}, "f:mountPath": {}, "f:name": {}}, "k:{\"mountPath\":\"/var/lib/rabbitmq/mnesia/\"}": {".": {}, "f:mountPath": {}, "f:name": {}}}}}, "f:restartPolicy": {}, "f:schedulerName": {}, "f:securityContext": {".": {}, "f:fsGroup": {}, "f:runAsGroup": {}, "f:runAsUser": {}}, "f:serviceAccount": {}, "f:serviceAccountName": {}, "f:subdomain": {}, "f:terminationGracePeriodSeconds": {}, "f:topologySpreadConstraints": {".": {}, "k:{\"topologyKey\":\"topology.kubernetes.io/zone\",\"whenUnsatisfiable\":\"ScheduleAnyway\"}": {".": {}, "f:labelSelector": {".": {}, "f:matchLabels": {".": {}, "f:app.kubernetes.io/name": {}}}, "f:maxSkew": {}, "f:topologyKey": {}, "f:whenUnsatisfiable": {}}}, "f:volumes": {".": {}, "k:{\"name\":\"erlang-cookie-secret\"}": {".": {}, "f:name": {}, "f:secret": {".": {}, "f:defaultMode": {}, "f:secretName": {}}}, "k:{\"name\":\"persistence\"}": {".": {}, "f:name": {}, "f:persistentVolumeClaim": {".": {}, "f:claimName": {}}}, "k:{\"name\":\"plugins-conf\"}": {".": {}, "f:configMap": {".": {}, "f:defaultMode": {}, "f:name": {}}, "f:name": {}}, "k:{\"name\":\"pod-info\"}": {".": {}, "f:downwardAPI": {".": {}, "f:defaultMode": {}, "f:items": {}}, "f:name": {}}, "k:{\"name\":\"rabbitmq-confd\"}": {".": {}, "f:name": {}, "f:projected": {".": {}, "f:defaultMode": {}, "f:sources": {}}}, "k:{\"name\":\"rabbitmq-erlang-cookie\"}": {".": {}, "f:emptyDir": {}, "f:name": {}}, "k:{\"name\":\"rabbitmq-plugins\"}": {".": {}, "f:emptyDir": {}, "f:name": {}}}}}}, {"manager": "kubelet", "operation": "Update", "apiVersion": "v1", "time": "2021-08-01T10:20:12Z", "fieldsType": "FieldsV1", "fieldsV1": {"f:status": {"f:conditions": {"k:{\"type\":\"ContainersReady\"}": {".": {}, "f:lastProbeTime": {}, "f:lastTransitionTime": {}, "f:status": {}, "f:type": {}}, "k:{\"type\":\"Initialized\"}": {".": {}, "f:lastProbeTime": {}, "f:lastTransitionTime": {}, "f:status": {}, "f:type": {}}, "k:{\"type\":\"Ready\"}": {".": {}, "f:lastProbeTime": {}, "f:lastTransitionTime": {}, "f:status": {}, "f:type": {}}}, "f:containerStatuses": {}, "f:hostIP": {}, "f:initContainerStatuses": {}, "f:phase": {}, "f:podIP": {}, "f:podIPs": {".": {}, "k:{\"ip\":\"10.244.3.4\"}": {".": {}, "f:ip": {}}}, "f:startTime": {}}}}]}, "spec": {"volumes": [{"name": "persistence", "persistentVolumeClaim": {"claimName": "persistence-rabbitmq-cluster-server-0"}}, {"name": "plugins-conf", "configMap": {"name": "rabbitmq-cluster-plugins-conf", "defaultMode": 420}}, {"name": "rabbitmq-confd", "projected": {"sources": [{"secret": {"name": "rabbitmq-cluster-default-user", "items": [{"key": "default_user.conf", "path": "default_user.conf"}]}}, {"configMap": {"name": "rabbitmq-cluster-server-conf", "items": [{"key": "operatorDefaults.conf", "path": "operatorDefaults.conf"}, {"key": "userDefinedConfiguration.conf", "path": "userDefinedConfiguration.conf"}]}}], "defaultMode": 420}}, {"name": "rabbitmq-erlang-cookie", "emptyDir": {}}, {"name": "erlang-cookie-secret", "secret": {"secretName": "rabbitmq-cluster-erlang-cookie", "defaultMode": 420}}, {"name": "rabbitmq-plugins", "emptyDir": {}}, {"name": "pod-info", "downwardAPI": {"items": [{"path": "skipPreStopChecks", "fieldRef": {"apiVersion": "v1", "fieldPath": "metadata.labels['skipPreStopChecks']"}}], "defaultMode": 420}}, {"name": "rabbitmq-cluster-server-token-pxpt4", "secret": {"secretName": "rabbitmq-cluster-server-token-pxpt4", "defaultMode": 420}}], "initContainers": [{"name": "setup-container", "image": "rabbitmq:3.8.12-management", "command": ["sh", "-c", "cp /tmp/erlang-cookie-secret/.erlang.cookie /var/lib/rabbitmq/.erlang.cookie && chown 999:999 /var/lib/rabbitmq/.erlang.cookie && chmod 600 /var/lib/rabbitmq/.erlang.cookie ; cp /tmp/rabbitmq-plugins/enabled_plugins /operator/enabled_plugins && chown 999:999 /operator/enabled_plugins ; chown 999:999 /var/lib/rabbitmq/mnesia/ ; echo '[default]' > /var/lib/rabbitmq/.rabbitmqadmin.conf && sed -e 's/default_user/username/' -e 's/default_pass/password/' /tmp/default_user.conf >> /var/lib/rabbitmq/.rabbitmqadmin.conf && chown 999:999 /var/lib/rabbitmq/.rabbitmqadmin.conf && chmod 600 /var/lib/rabbitmq/.rabbitmqadmin.conf"], "resources": {"limits": {"cpu": "100m", "memory": "500Mi"}, "requests": {"cpu": "100m", "memory": "500Mi"}}, "volumeMounts": [{"name": "plugins-conf", "mountPath": "/tmp/rabbitmq-plugins/"}, {"name": "rabbitmq-erlang-cookie", "mountPath": "/var/lib/rabbitmq/"}, {"name": "erlang-cookie-secret", "mountPath": "/tmp/erlang-cookie-secret/"}, {"name": "rabbitmq-plugins", "mountPath": "/operator"}, {"name": "persistence", "mountPath": "/var/lib/rabbitmq/mnesia/"}, {"name": "rabbitmq-confd", "mountPath": "/tmp/default_user.conf", "subPath": "default_user.conf"}, {"name": "rabbitmq-cluster-server-token-pxpt4", "readOnly": true, "mountPath": "/var/run/secrets/kubernetes.io/serviceaccount"}], "terminationMessagePath": "/dev/termination-log", "terminationMessagePolicy": "File", "imagePullPolicy": "IfNotPresent", "securityContext": {"capabilities": {"drop": ["FSETID", "KILL", "SETGID", "SETUID", "SETPCAP", "NET_BIND_SERVICE", "NET_RAW", "SYS_CHROOT", "MKNOD", "AUDIT_WRITE", "SETFCAP"]}, "runAsUser": 0}}], "containers": [{"name": "rabbitmq", "image": "rabbitmq:3.8.12-management", "ports": [{"name": "epmd", "containerPort": 4369, "protocol": "TCP"}, {"name": "amqp", "containerPort": 5672, "protocol": "TCP"}, {"name": "management", "containerPort": 15672, "protocol": "TCP"}, {"name": "prometheus", "containerPort": 15692, "protocol": "TCP"}], "env": [{"name": "MY_POD_NAME", "valueFrom": {"fieldRef": {"apiVersion": "v1", "fieldPath": "metadata.name"}}}, {"name": "MY_POD_NAMESPACE", "valueFrom": {"fieldRef": {"apiVersion": "v1", "fieldPath": "metadata.namespace"}}}, {"name": "RABBITMQ_ENABLED_PLUGINS_FILE", "value": "/operator/enabled_plugins"}, {"name": "K8S_SERVICE_NAME", "value": "rabbitmq-cluster-nodes"}, {"name": "RABBITMQ_USE_LONGNAME", "value": "true"}, {"name": "RABBITMQ_NODENAME", "value": "rabbit@$(MY_POD_NAME).$(K8S_SERVICE_NAME).$(MY_POD_NAMESPACE)"}, {"name": "K8S_HOSTNAME_SUFFIX", "value": ".$(K8S_SERVICE_NAME).$(MY_POD_NAMESPACE)"}], "resources": {"limits": {"cpu": "2", "memory": "2Gi"}, "requests": {"cpu": "1", "memory": "2Gi"}}, "volumeMounts": [{"name": "rabbitmq-erlang-cookie", "mountPath": "/var/lib/rabbitmq/"}, {"name": "persistence", "mountPath": "/var/lib/rabbitmq/mnesia/"}, {"name": "rabbitmq-plugins", "mountPath": "/operator"}, {"name": "rabbitmq-confd", "mountPath": "/etc/rabbitmq/conf.d/10-operatorDefaults.conf", "subPath": "operatorDefaults.conf"}, {"name": "rabbitmq-confd", "mountPath": "/etc/rabbitmq/conf.d/11-default_user.conf", "subPath": "default_user.conf"}, {"name": "rabbitmq-confd", "mountPath": "/etc/rabbitmq/conf.d/90-userDefinedConfiguration.conf", "subPath": "userDefinedConfiguration.conf"}, {"name": "pod-info", "mountPath": "/etc/pod-info/"}, {"name": "rabbitmq-cluster-server-token-pxpt4", "readOnly": true, "mountPath": "/var/run/secrets/kubernetes.io/serviceaccount"}], "readinessProbe": {"tcpSocket": {"port": "amqp"}, "initialDelaySeconds": 10, "timeoutSeconds": 5, "periodSeconds": 10, "successThreshold": 1, "failureThreshold": 3}, "lifecycle": {"preStop": {"exec": {"command": ["/bin/bash", "-c", "if [ ! -z \"$(cat /etc/pod-info/skipPreStopChecks)\" ]; then exit 0; fi; rabbitmq-upgrade await_online_quorum_plus_one -t 604800; rabbitmq-upgrade await_online_synchronized_mirror -t 604800; rabbitmq-upgrade drain -t 604800"]}}}, "terminationMessagePath": "/dev/termination-log", "terminationMessagePolicy": "File", "imagePullPolicy": "IfNotPresent"}], "restartPolicy": "Always", "terminationGracePeriodSeconds": 604800, "dnsPolicy": "ClusterFirst", "serviceAccountName": "rabbitmq-cluster-server", "serviceAccount": "rabbitmq-cluster-server", "automountServiceAccountToken": true, "nodeName": "kind-worker", "securityContext": {"runAsUser": 999, "runAsGroup": 999, "fsGroup": 999}, "hostname": "rabbitmq-cluster-server-0", "subdomain": "rabbitmq-cluster-nodes", "schedulerName": "default-scheduler", "tolerations": [{"key": "node.kubernetes.io/not-ready", "operator": "Exists", "effect": "NoExecute", "tolerationSeconds": 300}, {"key": "node.kubernetes.io/unreachable", "operator": "Exists", "effect": "NoExecute", "tolerationSeconds": 300}], "priority": 0, "enableServiceLinks": true, "topologySpreadConstraints": [{"maxSkew": 1, "topologyKey": "topology.kubernetes.io/zone", "whenUnsatisfiable": "ScheduleAnyway", "labelSelector": {"matchLabels": {"app.kubernetes.io/name": "rabbitmq-cluster"}}}]}, "status": {"phase": "Running", "conditions": [{"type": "Initialized", "status": "True", "lastProbeTime": null, "lastTransitionTime": "2021-08-01T10:19:42Z"}, {"type": "Ready", "status": "True", "lastProbeTime": null, "lastTransitionTime": "2021-08-01T10:20:12Z"}, {"type": "ContainersReady", "status": "True", "lastProbeTime": null, "lastTransitionTime": "2021-08-01T10:20:12Z"}, {"type": "PodScheduled", "status": "True", "lastProbeTime": null, "lastTransitionTime": "2021-08-01T10:19:26Z"}], "hostIP": "172.18.0.6", "podIP": "10.244.3.4", "podIPs": [{"ip": "10.244.3.4"}], "startTime": "2021-08-01T10:19:26Z", "initContainerStatuses": [{"name": "setup-container", "state": {"terminated": {"exitCode": 0, "reason": "Completed", "startedAt": "2021-08-01T10:19:41Z", "finishedAt": "2021-08-01T10:19:41Z", "containerID": "containerd://f70cad46ea9e960266a670066d27e28e9af93255a83488abfa3d3051d103adba"}}, "lastState": {}, "ready": true, "restartCount": 0, "image": "docker.io/library/rabbitmq:3.8.12-management", "imageID": "docker.io/library/rabbitmq@sha256:00ad24aace28bee5f903a3ce89c6e538d99a86dd764a2f86e26ef9a48327a66b", "containerID": "containerd://f70cad46ea9e960266a670066d27e28e9af93255a83488abfa3d3051d103adba"}], "containerStatuses": [{"name": "rabbitmq", "state": {"running": {"startedAt": "2021-08-01T10:19:42Z"}}, "lastState": {}, "ready": true, "restartCount": 0, "image": "docker.io/library/rabbitmq:3.8.12-management", "imageID": "docker.io/library/rabbitmq@sha256:00ad24aace28bee5f903a3ce89c6e538d99a86dd764a2f86e26ef9a48327a66b", "containerID": "containerd://60b7bae0f38ac99964b43c7a1e4f24ebdffc7f3846eda439f4074e1115a8ba6a", "started": true}], "qosClass": "Burstable"}}, {"metadata": {"name": "rabbitmq-cluster-server-1", "generateName": "rabbitmq-cluster-server-", "namespace": "default", "selfLink": "/api/v1/namespaces/default/pods/rabbitmq-cluster-server-1", "uid": "5b3a7057-4f8b-430b-a43c-ea145c1b5fc7", "resourceVersion": "1707", "creationTimestamp": "2021-08-01T10:20:26Z", "labels": {"app.kubernetes.io/component": "rabbitmq", "app.kubernetes.io/name": "rabbitmq-cluster", "app.kubernetes.io/part-of": "rabbitmq", "controller-revision-hash": "rabbitmq-cluster-server-5f8b8665fb", "statefulset.kubernetes.io/pod-name": "rabbitmq-cluster-server-1"}, "annotations": {"prometheus.io/port": "15692", "prometheus.io/scrape": "true"}, "ownerReferences": [{"apiVersion": "apps/v1", "kind": "StatefulSet", "name": "rabbitmq-cluster-server", "uid": "757c5705-804d-4916-b633-1a1555612182", "controller": true, "blockOwnerDeletion": true}], "managedFields": [{"manager": "kube-controller-manager", "operation": "Update", "apiVersion": "v1", "time": "2021-08-01T10:20:26Z", "fieldsType": "FieldsV1", "fieldsV1": {"f:metadata": {"f:annotations": {".": {}, "f:prometheus.io/port": {}, "f:prometheus.io/scrape": {}}, "f:generateName": {}, "f:labels": {".": {}, "f:app.kubernetes.io/component": {}, "f:app.kubernetes.io/name": {}, "f:app.kubernetes.io/part-of": {}, "f:controller-revision-hash": {}, "f:statefulset.kubernetes.io/pod-name": {}}, "f:ownerReferences": {".": {}, "k:{\"uid\":\"757c5705-804d-4916-b633-1a1555612182\"}": {".": {}, "f:apiVersion": {}, "f:blockOwnerDeletion": {}, "f:controller": {}, "f:kind": {}, "f:name": {}, "f:uid": {}}}}, "f:spec": {"f:automountServiceAccountToken": {}, "f:containers": {"k:{\"name\":\"rabbitmq\"}": {".": {}, "f:env": {".": {}, "k:{\"name\":\"K8S_HOSTNAME_SUFFIX\"}": {".": {}, "f:name": {}, "f:value": {}}, "k:{\"name\":\"K8S_SERVICE_NAME\"}": {".": {}, "f:name": {}, "f:value": {}}, "k:{\"name\":\"MY_POD_NAME\"}": {".": {}, "f:name": {}, "f:valueFrom": {".": {}, "f:fieldRef": {".": {}, "f:apiVersion": {}, "f:fieldPath": {}}}}, "k:{\"name\":\"MY_POD_NAMESPACE\"}": {".": {}, "f:name": {}, "f:valueFrom": {".": {}, "f:fieldRef": {".": {}, "f:apiVersion": {}, "f:fieldPath": {}}}}, "k:{\"name\":\"RABBITMQ_ENABLED_PLUGINS_FILE\"}": {".": {}, "f:name": {}, "f:value": {}}, "k:{\"name\":\"RABBITMQ_NODENAME\"}": {".": {}, "f:name": {}, "f:value": {}}, "k:{\"name\":\"RABBITMQ_USE_LONGNAME\"}": {".": {}, "f:name": {}, "f:value": {}}}, "f:image": {}, "f:imagePullPolicy": {}, "f:lifecycle": {".": {}, "f:preStop": {".": {}, "f:exec": {".": {}, "f:command": {}}}}, "f:name": {}, "f:ports": {".": {}, "k:{\"containerPort\":4369,\"protocol\":\"TCP\"}": {".": {}, "f:containerPort": {}, "f:name": {}, "f:protocol": {}}, "k:{\"containerPort\":5672,\"protocol\":\"TCP\"}": {".": {}, "f:containerPort": {}, "f:name": {}, "f:protocol": {}}, "k:{\"containerPort\":15672,\"protocol\":\"TCP\"}": {".": {}, "f:containerPort": {}, "f:name": {}, "f:protocol": {}}, "k:{\"containerPort\":15692,\"protocol\":\"TCP\"}": {".": {}, "f:containerPort": {}, "f:name": {}, "f:protocol": {}}}, "f:readinessProbe": {".": {}, "f:failureThreshold": {}, "f:initialDelaySeconds": {}, "f:periodSeconds": {}, "f:successThreshold": {}, "f:tcpSocket": {".": {}, "f:port": {}}, "f:timeoutSeconds": {}}, "f:resources": {".": {}, "f:limits": {".": {}, "f:cpu": {}, "f:memory": {}}, "f:requests": {".": {}, "f:cpu": {}, "f:memory": {}}}, "f:terminationMessagePath": {}, "f:terminationMessagePolicy": {}, "f:volumeMounts": {".": {}, "k:{\"mountPath\":\"/etc/pod-info/\"}": {".": {}, "f:mountPath": {}, "f:name": {}}, "k:{\"mountPath\":\"/etc/rabbitmq/conf.d/10-operatorDefaults.conf\"}": {".": {}, "f:mountPath": {}, "f:name": {}, "f:subPath": {}}, "k:{\"mountPath\":\"/etc/rabbitmq/conf.d/11-default_user.conf\"}": {".": {}, "f:mountPath": {}, "f:name": {}, "f:subPath": {}}, "k:{\"mountPath\":\"/etc/rabbitmq/conf.d/90-userDefinedConfiguration.conf\"}": {".": {}, "f:mountPath": {}, "f:name": {}, "f:subPath": {}}, "k:{\"mountPath\":\"/operator\"}": {".": {}, "f:mountPath": {}, "f:name": {}}, "k:{\"mountPath\":\"/var/lib/rabbitmq/\"}": {".": {}, "f:mountPath": {}, "f:name": {}}, "k:{\"mountPath\":\"/var/lib/rabbitmq/mnesia/\"}": {".": {}, "f:mountPath": {}, "f:name": {}}}}}, "f:dnsPolicy": {}, "f:enableServiceLinks": {}, "f:hostname": {}, "f:initContainers": {".": {}, "k:{\"name\":\"setup-container\"}": {".": {}, "f:command": {}, "f:image": {}, "f:imagePullPolicy": {}, "f:name": {}, "f:resources": {".": {}, "f:limits": {".": {}, "f:cpu": {}, "f:memory": {}}, "f:requests": {".": {}, "f:cpu": {}, "f:memory": {}}}, "f:securityContext": {".": {}, "f:capabilities": {".": {}, "f:drop": {}}, "f:runAsUser": {}}, "f:terminationMessagePath": {}, "f:terminationMessagePolicy": {}, "f:volumeMounts": {".": {}, "k:{\"mountPath\":\"/operator\"}": {".": {}, "f:mountPath": {}, "f:name": {}}, "k:{\"mountPath\":\"/tmp/default_user.conf\"}": {".": {}, "f:mountPath": {}, "f:name": {}, "f:subPath": {}}, "k:{\"mountPath\":\"/tmp/erlang-cookie-secret/\"}": {".": {}, "f:mountPath": {}, "f:name": {}}, "k:{\"mountPath\":\"/tmp/rabbitmq-plugins/\"}": {".": {}, "f:mountPath": {}, "f:name": {}}, "k:{\"mountPath\":\"/var/lib/rabbitmq/\"}": {".": {}, "f:mountPath": {}, "f:name": {}}, "k:{\"mountPath\":\"/var/lib/rabbitmq/mnesia/\"}": {".": {}, "f:mountPath": {}, "f:name": {}}}}}, "f:restartPolicy": {}, "f:schedulerName": {}, "f:securityContext": {".": {}, "f:fsGroup": {}, "f:runAsGroup": {}, "f:runAsUser": {}}, "f:serviceAccount": {}, "f:serviceAccountName": {}, "f:subdomain": {}, "f:terminationGracePeriodSeconds": {}, "f:topologySpreadConstraints": {".": {}, "k:{\"topologyKey\":\"topology.kubernetes.io/zone\",\"whenUnsatisfiable\":\"ScheduleAnyway\"}": {".": {}, "f:labelSelector": {".": {}, "f:matchLabels": {".": {}, "f:app.kubernetes.io/name": {}}}, "f:maxSkew": {}, "f:topologyKey": {}, "f:whenUnsatisfiable": {}}}, "f:volumes": {".": {}, "k:{\"name\":\"erlang-cookie-secret\"}": {".": {}, "f:name": {}, "f:secret": {".": {}, "f:defaultMode": {}, "f:secretName": {}}}, "k:{\"name\":\"persistence\"}": {".": {}, "f:name": {}, "f:persistentVolumeClaim": {".": {}, "f:claimName": {}}}, "k:{\"name\":\"plugins-conf\"}": {".": {}, "f:configMap": {".": {}, "f:defaultMode": {}, "f:name": {}}, "f:name": {}}, "k:{\"name\":\"pod-info\"}": {".": {}, "f:downwardAPI": {".": {}, "f:defaultMode": {}, "f:items": {}}, "f:name": {}}, "k:{\"name\":\"rabbitmq-confd\"}": {".": {}, "f:name": {}, "f:projected": {".": {}, "f:defaultMode": {}, "f:sources": {}}}, "k:{\"name\":\"rabbitmq-erlang-cookie\"}": {".": {}, "f:emptyDir": {}, "f:name": {}}, "k:{\"name\":\"rabbitmq-plugins\"}": {".": {}, "f:emptyDir": {}, "f:name": {}}}}}}, {"manager": "kubelet", "operation": "Update", "apiVersion": "v1", "time": "2021-08-01T10:21:13Z", "fieldsType": "FieldsV1", "fieldsV1": {"f:status": {"f:conditions": {"k:{\"type\":\"ContainersReady\"}": {".": {}, "f:lastProbeTime": {}, "f:lastTransitionTime": {}, "f:status": {}, "f:type": {}}, "k:{\"type\":\"Initialized\"}": {".": {}, "f:lastProbeTime": {}, "f:lastTransitionTime": {}, "f:status": {}, "f:type": {}}, "k:{\"type\":\"Ready\"}": {".": {}, "f:lastProbeTime": {}, "f:lastTransitionTime": {}, "f:status": {}, "f:type": {}}}, "f:containerStatuses": {}, "f:hostIP": {}, "f:initContainerStatuses": {}, "f:phase": {}, "f:podIP": {}, "f:podIPs": {".": {}, "k:{\"ip\":\"10.244.4.3\"}": {".": {}, "f:ip": {}}}, "f:startTime": {}}}}]}, "spec": {"volumes": [{"name": "persistence", "persistentVolumeClaim": {"claimName": "persistence-rabbitmq-cluster-server-1"}}, {"name": "plugins-conf", "configMap": {"name": "rabbitmq-cluster-plugins-conf", "defaultMode": 420}}, {"name": "rabbitmq-confd", "projected": {"sources": [{"secret": {"name": "rabbitmq-cluster-default-user", "items": [{"key": "default_user.conf", "path": "default_user.conf"}]}}, {"configMap": {"name": "rabbitmq-cluster-server-conf", "items": [{"key": "operatorDefaults.conf", "path": "operatorDefaults.conf"}, {"key": "userDefinedConfiguration.conf", "path": "userDefinedConfiguration.conf"}]}}], "defaultMode": 420}}, {"name": "rabbitmq-erlang-cookie", "emptyDir": {}}, {"name": "erlang-cookie-secret", "secret": {"secretName": "rabbitmq-cluster-erlang-cookie", "defaultMode": 420}}, {"name": "rabbitmq-plugins", "emptyDir": {}}, {"name": "pod-info", "downwardAPI": {"items": [{"path": "skipPreStopChecks", "fieldRef": {"apiVersion": "v1", "fieldPath": "metadata.labels['skipPreStopChecks']"}}], "defaultMode": 420}}, {"name": "rabbitmq-cluster-server-token-pxpt4", "secret": {"secretName": "rabbitmq-cluster-server-token-pxpt4", "defaultMode": 420}}], "initContainers": [{"name": "setup-container", "image": "rabbitmq:3.8.12-management", "command": ["sh", "-c", "cp /tmp/erlang-cookie-secret/.erlang.cookie /var/lib/rabbitmq/.erlang.cookie && chown 999:999 /var/lib/rabbitmq/.erlang.cookie && chmod 600 /var/lib/rabbitmq/.erlang.cookie ; cp /tmp/rabbitmq-plugins/enabled_plugins /operator/enabled_plugins && chown 999:999 /operator/enabled_plugins ; chown 999:999 /var/lib/rabbitmq/mnesia/ ; echo '[default]' > /var/lib/rabbitmq/.rabbitmqadmin.conf && sed -e 's/default_user/username/' -e 's/default_pass/password/' /tmp/default_user.conf >> /var/lib/rabbitmq/.rabbitmqadmin.conf && chown 999:999 /var/lib/rabbitmq/.rabbitmqadmin.conf && chmod 600 /var/lib/rabbitmq/.rabbitmqadmin.conf"], "resources": {"limits": {"cpu": "100m", "memory": "500Mi"}, "requests": {"cpu": "100m", "memory": "500Mi"}}, "volumeMounts": [{"name": "plugins-conf", "mountPath": "/tmp/rabbitmq-plugins/"}, {"name": "rabbitmq-erlang-cookie", "mountPath": "/var/lib/rabbitmq/"}, {"name": "erlang-cookie-secret", "mountPath": "/tmp/erlang-cookie-secret/"}, {"name": "rabbitmq-plugins", "mountPath": "/operator"}, {"name": "persistence", "mountPath": "/var/lib/rabbitmq/mnesia/"}, {"name": "rabbitmq-confd", "mountPath": "/tmp/default_user.conf", "subPath": "default_user.conf"}, {"name": "rabbitmq-cluster-server-token-pxpt4", "readOnly": true, "mountPath": "/var/run/secrets/kubernetes.io/serviceaccount"}], "terminationMessagePath": "/dev/termination-log", "terminationMessagePolicy": "File", "imagePullPolicy": "IfNotPresent", "securityContext": {"capabilities": {"drop": ["FSETID", "KILL", "SETGID", "SETUID", "SETPCAP", "NET_BIND_SERVICE", "NET_RAW", "SYS_CHROOT", "MKNOD", "AUDIT_WRITE", "SETFCAP"]}, "runAsUser": 0}}], "containers": [{"name": "rabbitmq", "image": "rabbitmq:3.8.12-management", "ports": [{"name": "epmd", "containerPort": 4369, "protocol": "TCP"}, {"name": "amqp", "containerPort": 5672, "protocol": "TCP"}, {"name": "management", "containerPort": 15672, "protocol": "TCP"}, {"name": "prometheus", "containerPort": 15692, "protocol": "TCP"}], "env": [{"name": "MY_POD_NAME", "valueFrom": {"fieldRef": {"apiVersion": "v1", "fieldPath": "metadata.name"}}}, {"name": "MY_POD_NAMESPACE", "valueFrom": {"fieldRef": {"apiVersion": "v1", "fieldPath": "metadata.namespace"}}}, {"name": "RABBITMQ_ENABLED_PLUGINS_FILE", "value": "/operator/enabled_plugins"}, {"name": "K8S_SERVICE_NAME", "value": "rabbitmq-cluster-nodes"}, {"name": "RABBITMQ_USE_LONGNAME", "value": "true"}, {"name": "RABBITMQ_NODENAME", "value": "rabbit@$(MY_POD_NAME).$(K8S_SERVICE_NAME).$(MY_POD_NAMESPACE)"}, {"name": "K8S_HOSTNAME_SUFFIX", "value": ".$(K8S_SERVICE_NAME).$(MY_POD_NAMESPACE)"}], "resources": {"limits": {"cpu": "2", "memory": "2Gi"}, "requests": {"cpu": "1", "memory": "2Gi"}}, "volumeMounts": [{"name": "rabbitmq-erlang-cookie", "mountPath": "/var/lib/rabbitmq/"}, {"name": "persistence", "mountPath": "/var/lib/rabbitmq/mnesia/"}, {"name": "rabbitmq-plugins", "mountPath": "/operator"}, {"name": "rabbitmq-confd", "mountPath": "/etc/rabbitmq/conf.d/10-operatorDefaults.conf", "subPath": "operatorDefaults.conf"}, {"name": "rabbitmq-confd", "mountPath": "/etc/rabbitmq/conf.d/11-default_user.conf", "subPath": "default_user.conf"}, {"name": "rabbitmq-confd", "mountPath": "/etc/rabbitmq/conf.d/90-userDefinedConfiguration.conf", "subPath": "userDefinedConfiguration.conf"}, {"name": "pod-info", "mountPath": "/etc/pod-info/"}, {"name": "rabbitmq-cluster-server-token-pxpt4", "readOnly": true, "mountPath": "/var/run/secrets/kubernetes.io/serviceaccount"}], "readinessProbe": {"tcpSocket": {"port": "amqp"}, "initialDelaySeconds": 10, "timeoutSeconds": 5, "periodSeconds": 10, "successThreshold": 1, "failureThreshold": 3}, "lifecycle": {"preStop": {"exec": {"command": ["/bin/bash", "-c", "if [ ! -z \"$(cat /etc/pod-info/skipPreStopChecks)\" ]; then exit 0; fi; rabbitmq-upgrade await_online_quorum_plus_one -t 604800; rabbitmq-upgrade await_online_synchronized_mirror -t 604800; rabbitmq-upgrade drain -t 604800"]}}}, "terminationMessagePath": "/dev/termination-log", "terminationMessagePolicy": "File", "imagePullPolicy": "IfNotPresent"}], "restartPolicy": "Always", "terminationGracePeriodSeconds": 604800, "dnsPolicy": "ClusterFirst", "serviceAccountName": "rabbitmq-cluster-server", "serviceAccount": "rabbitmq-cluster-server", "automountServiceAccountToken": true, "nodeName": "kind-worker2", "securityContext": {"runAsUser": 999, "runAsGroup": 999, "fsGroup": 999}, "hostname": "rabbitmq-cluster-server-1", "subdomain": "rabbitmq-cluster-nodes", "schedulerName": "default-scheduler", "tolerations": [{"key": "node.kubernetes.io/not-ready", "operator": "Exists", "effect": "NoExecute", "tolerationSeconds": 300}, {"key": "node.kubernetes.io/unreachable", "operator": "Exists", "effect": "NoExecute", "tolerationSeconds": 300}], "priority": 0, "enableServiceLinks": true, "topologySpreadConstraints": [{"maxSkew": 1, "topologyKey": "topology.kubernetes.io/zone", "whenUnsatisfiable": "ScheduleAnyway", "labelSelector": {"matchLabels": {"app.kubernetes.io/name": "rabbitmq-cluster"}}}]}, "status": {"phase": "Running", "conditions": [{"type": "Initialized", "status": "True", "lastProbeTime": null, "lastTransitionTime": "2021-08-01T10:20:44Z"}, {"type": "Ready", "status": "True", "lastProbeTime": null, "lastTransitionTime": "2021-08-01T10:21:13Z"}, {"type": "ContainersReady", "status": "True", "lastProbeTime": null, "lastTransitionTime": "2021-08-01T10:21:13Z"}, {"type": "PodScheduled", "status": "True", "lastProbeTime": null, "lastTransitionTime": "2021-08-01T10:20:29Z"}], "hostIP": "172.18.0.3", "podIP": "10.244.4.3", "podIPs": [{"ip": "10.244.4.3"}], "startTime": "2021-08-01T10:20:29Z", "initContainerStatuses": [{"name": "setup-container", "state": {"terminated": {"exitCode": 0, "reason": "Completed", "startedAt": "2021-08-01T10:20:43Z", "finishedAt": "2021-08-01T10:20:43Z", "containerID": "containerd://fb1dc6d42e1c5d0bbc6e8e60f5085b3eace58a5d42a606b374575c8a96e58fe0"}}, "lastState": {}, "ready": true, "restartCount": 0, "image": "docker.io/library/rabbitmq:3.8.12-management", "imageID": "docker.io/library/rabbitmq@sha256:00ad24aace28bee5f903a3ce89c6e538d99a86dd764a2f86e26ef9a48327a66b", "containerID": "containerd://fb1dc6d42e1c5d0bbc6e8e60f5085b3eace58a5d42a606b374575c8a96e58fe0"}], "containerStatuses": [{"name": "rabbitmq", "state": {"running": {"startedAt": "2021-08-01T10:20:44Z"}}, "lastState": {}, "ready": true, "restartCount": 0, "image": "docker.io/library/rabbitmq:3.8.12-management", "imageID": "docker.io/library/rabbitmq@sha256:00ad24aace28bee5f903a3ce89c6e538d99a86dd764a2f86e26ef9a48327a66b", "containerID": "containerd://0bd40d41f885ac8ba1f76ca680e430a4f96abd2f03a905195e6d937d325e74d8", "started": true}], "qosClass": "Burstable"}}, {"metadata": {"name": "rabbitmq-operator-774b86b97d-mbx5l", "generateName": "rabbitmq-operator-774b86b97d-", "namespace": "default", "selfLink": "/api/v1/namespaces/default/pods/rabbitmq-operator-774b86b97d-mbx5l", "uid": "3f796c27-569c-4dcd-a79c-65afc51ab0b3", "resourceVersion": "1016", "creationTimestamp": "2021-08-01T10:19:05Z", "labels": {"app.kubernetes.io/component": "rabbitmq-cluster-operator", "app.kubernetes.io/name": "rabbitmq-cluster-operator", "app.kubernetes.io/part-of": "rabbitmq", "pod-template-hash": "774b86b97d", "sonartag": "rabbitmq-operator"}, "ownerReferences": [{"apiVersion": "apps/v1", "kind": "ReplicaSet", "name": "rabbitmq-operator-774b86b97d", "uid": "23062978-7f09-45d8-bc6f-ce9a9f64565f", "controller": true, "blockOwnerDeletion": true}], "managedFields": [{"manager": "kube-controller-manager", "operation": "Update", "apiVersion": "v1", "time": "2021-08-01T10:19:05Z", "fieldsType": "FieldsV1", "fieldsV1": {"f:metadata": {"f:generateName": {}, "f:labels": {".": {}, "f:app.kubernetes.io/component": {}, "f:app.kubernetes.io/name": {}, "f:app.kubernetes.io/part-of": {}, "f:pod-template-hash": {}, "f:sonartag": {}}, "f:ownerReferences": {".": {}, "k:{\"uid\":\"23062978-7f09-45d8-bc6f-ce9a9f64565f\"}": {".": {}, "f:apiVersion": {}, "f:blockOwnerDeletion": {}, "f:controller": {}, "f:kind": {}, "f:name": {}, "f:uid": {}}}}, "f:spec": {"f:containers": {"k:{\"name\":\"operator\"}": {".": {}, "f:command": {}, "f:env": {".": {}, "k:{\"name\":\"KUBERNETES_SERVICE_HOST\"}": {".": {}, "f:name": {}, "f:value": {}}, "k:{\"name\":\"KUBERNETES_SERVICE_PORT\"}": {".": {}, "f:name": {}, "f:value": {}}, "k:{\"name\":\"OPERATOR_NAMESPACE\"}": {".": {}, "f:name": {}, "f:valueFrom": {".": {}, "f:fieldRef": {".": {}, "f:apiVersion": {}, "f:fieldPath": {}}}}}, "f:envFrom": {}, "f:image": {}, "f:imagePullPolicy": {}, "f:name": {}, "f:ports": {".": {}, "k:{\"containerPort\":9782,\"protocol\":\"TCP\"}": {".": {}, "f:containerPort": {}, "f:name": {}, "f:protocol": {}}}, "f:resources": {".": {}, "f:limits": {".": {}, "f:cpu": {}, "f:memory": {}}, "f:requests": {".": {}, "f:cpu": {}, "f:memory": {}}}, "f:terminationMessagePath": {}, "f:terminationMessagePolicy": {}}}, "f:dnsPolicy": {}, "f:enableServiceLinks": {}, "f:restartPolicy": {}, "f:schedulerName": {}, "f:securityContext": {".": {}, "f:fsGroup": {}, "f:runAsGroup": {}, "f:runAsUser": {}}, "f:serviceAccount": {}, "f:serviceAccountName": {}, "f:terminationGracePeriodSeconds": {}}}}, {"manager": "kubelet", "operation": "Update", "apiVersion": "v1", "time": "2021-08-01T10:19:08Z", "fieldsType": "FieldsV1", "fieldsV1": {"f:status": {"f:conditions": {"k:{\"type\":\"ContainersReady\"}": {".": {}, "f:lastProbeTime": {}, "f:lastTransitionTime": {}, "f:status": {}, "f:type": {}}, "k:{\"type\":\"Initialized\"}": {".": {}, "f:lastProbeTime": {}, "f:lastTransitionTime": {}, "f:status": {}, "f:type": {}}, "k:{\"type\":\"Ready\"}": {".": {}, "f:lastProbeTime": {}, "f:lastTransitionTime": {}, "f:status": {}, "f:type": {}}}, "f:containerStatuses": {}, "f:hostIP": {}, "f:phase": {}, "f:podIP": {}, "f:podIPs": {".": {}, "k:{\"ip\":\"10.244.3.2\"}": {".": {}, "f:ip": {}}}, "f:startTime": {}}}}]}, "spec": {"volumes": [{"name": "rabbitmq-cluster-operator-token-gd4fz", "secret": {"secretName": "rabbitmq-cluster-operator-token-gd4fz", "defaultMode": 420}}], "containers": [{"name": "operator", "image": "laphets/rabbitmq-operator:obs-gap", "command": ["/manager"], "ports": [{"name": "metrics", "containerPort": 9782, "protocol": "TCP"}], "envFrom": [{"configMapRef": {"name": "sonar-testing-global-config"}}], "env": [{"name": "OPERATOR_NAMESPACE", "valueFrom": {"fieldRef": {"apiVersion": "v1", "fieldPath": "metadata.namespace"}}}, {"name": "KUBERNETES_SERVICE_HOST", "value": "kind-control-plane"}, {"name": "KUBERNETES_SERVICE_PORT", "value": "6443"}], "resources": {"limits": {"cpu": "200m", "memory": "500Mi"}, "requests": {"cpu": "200m", "memory": "500Mi"}}, "volumeMounts": [{"name": "rabbitmq-cluster-operator-token-gd4fz", "readOnly": true, "mountPath": "/var/run/secrets/kubernetes.io/serviceaccount"}], "terminationMessagePath": "/dev/termination-log", "terminationMessagePolicy": "File", "imagePullPolicy": "IfNotPresent"}], "restartPolicy": "Always", "terminationGracePeriodSeconds": 10, "dnsPolicy": "ClusterFirst", "serviceAccountName": "rabbitmq-cluster-operator", "serviceAccount": "rabbitmq-cluster-operator", "nodeName": "kind-worker", "securityContext": {"runAsUser": 1000, "runAsGroup": 1000, "fsGroup": 1000}, "schedulerName": "default-scheduler", "tolerations": [{"key": "node.kubernetes.io/not-ready", "operator": "Exists", "effect": "NoExecute", "tolerationSeconds": 300}, {"key": "node.kubernetes.io/unreachable", "operator": "Exists", "effect": "NoExecute", "tolerationSeconds": 300}], "priority": 0, "enableServiceLinks": true}, "status": {"phase": "Running", "conditions": [{"type": "Initialized", "status": "True", "lastProbeTime": null, "lastTransitionTime": "2021-08-01T10:19:05Z"}, {"type": "Ready", "status": "True", "lastProbeTime": null, "lastTransitionTime": "2021-08-01T10:19:08Z"}, {"type": "ContainersReady", "status": "True", "lastProbeTime": null, "lastTransitionTime": "2021-08-01T10:19:08Z"}, {"type": "PodScheduled", "status": "True", "lastProbeTime": null, "lastTransitionTime": "2021-08-01T10:19:05Z"}], "hostIP": "172.18.0.6", "podIP": "10.244.3.2", "podIPs": [{"ip": "10.244.3.2"}], "startTime": "2021-08-01T10:19:05Z", "containerStatuses": [{"name": "operator", "state": {"running": {"startedAt": "2021-08-01T10:19:07Z"}}, "lastState": {}, "ready": true, "restartCount": 0, "image": "docker.io/laphets/rabbitmq-operator:obs-gap", "imageID": "sha256:e4ed4ab264e484d258773b239e146e62f7c09fc7f76c8839ecc497b26be05d91", "containerID": "containerd://910b428f611e91d0d4da3cc21e9dfdb7f5186d38bb1053ecdb02db1606af4b2f", "started": true}], "qosClass": "Guaranteed"}}], "persistentvolumeclaim": [{"metadata": {"name": "persistence-rabbitmq-cluster-server-0", "namespace": "default", "selfLink": "/api/v1/namespaces/default/persistentvolumeclaims/persistence-rabbitmq-cluster-server-0", "uid": "87c71325-728c-42d4-912d-cd654188fa1d", "resourceVersion": "1165", "creationTimestamp": "2021-08-01T10:19:21Z", "labels": {"app.kubernetes.io/component": "rabbitmq", "app.kubernetes.io/name": "rabbitmq-cluster", "app.kubernetes.io/part-of": "rabbitmq"}, "annotations": {"pv.kubernetes.io/bind-completed": "yes", "pv.kubernetes.io/bound-by-controller": "yes", "volume.beta.kubernetes.io/storage-provisioner": "rancher.io/local-path", "volume.kubernetes.io/selected-node": "kind-worker"}, "ownerReferences": [{"apiVersion": "rabbitmq.com/v1beta1", "kind": "RabbitmqCluster", "name": "rabbitmq-cluster", "uid": "ea47ca4d-4331-455c-9091-1cd85e73d623", "controller": true, "blockOwnerDeletion": false}], "finalizers": ["kubernetes.io/pvc-protection"], "managedFields": [{"manager": "kube-scheduler", "operation": "Update", "apiVersion": "v1", "time": "2021-08-01T10:19:21Z", "fieldsType": "FieldsV1", "fieldsV1": {"f:metadata": {"f:annotations": {".": {}, "f:volume.kubernetes.io/selected-node": {}}}}}, {"manager": "kube-controller-manager", "operation": "Update", "apiVersion": "v1", "time": "2021-08-01T10:19:26Z", "fieldsType": "FieldsV1", "fieldsV1": {"f:metadata": {"f:annotations": {"f:pv.kubernetes.io/bind-completed": {}, "f:pv.kubernetes.io/bound-by-controller": {}, "f:volume.beta.kubernetes.io/storage-provisioner": {}}, "f:labels": {".": {}, "f:app.kubernetes.io/component": {}, "f:app.kubernetes.io/name": {}, "f:app.kubernetes.io/part-of": {}}, "f:ownerReferences": {".": {}, "k:{\"uid\":\"ea47ca4d-4331-455c-9091-1cd85e73d623\"}": {".": {}, "f:apiVersion": {}, "f:blockOwnerDeletion": {}, "f:controller": {}, "f:kind": {}, "f:name": {}, "f:uid": {}}}}, "f:spec": {"f:accessModes": {}, "f:resources": {"f:requests": {".": {}, "f:storage": {}}}, "f:volumeMode": {}, "f:volumeName": {}}, "f:status": {"f:accessModes": {}, "f:capacity": {".": {}, "f:storage": {}}, "f:phase": {}}}}]}, "spec": {"accessModes": ["ReadWriteOnce"], "resources": {"requests": {"storage": "10Gi"}}, "volumeName": "pvc-87c71325-728c-42d4-912d-cd654188fa1d", "storageClassName": "standard", "volumeMode": "Filesystem"}, "status": {"phase": "Bound", "accessModes": ["ReadWriteOnce"], "capacity": {"storage": "10Gi"}}}, {"metadata": {"name": "persistence-rabbitmq-cluster-server-1", "namespace": "default", "selfLink": "/api/v1/namespaces/default/persistentvolumeclaims/persistence-rabbitmq-cluster-server-1", "uid": "035970e5-2836-4e50-9084-3f404994c270", "resourceVersion": "1497", "creationTimestamp": "2021-08-01T10:20:26Z", "labels": {"app.kubernetes.io/component": "rabbitmq", "app.kubernetes.io/name": "rabbitmq-cluster", "app.kubernetes.io/part-of": "rabbitmq"}, "annotations": {"pv.kubernetes.io/bind-completed": "yes", "pv.kubernetes.io/bound-by-controller": "yes", "volume.beta.kubernetes.io/storage-provisioner": "rancher.io/local-path", "volume.kubernetes.io/selected-node": "kind-worker2"}, "ownerReferences": [{"apiVersion": "rabbitmq.com/v1beta1", "kind": "RabbitmqCluster", "name": "rabbitmq-cluster", "uid": "ea47ca4d-4331-455c-9091-1cd85e73d623", "controller": true, "blockOwnerDeletion": false}], "finalizers": ["kubernetes.io/pvc-protection"], "managedFields": [{"manager": "kube-scheduler", "operation": "Update", "apiVersion": "v1", "time": "2021-08-01T10:20:26Z", "fieldsType": "FieldsV1", "fieldsV1": {"f:metadata": {"f:annotations": {".": {}, "f:volume.kubernetes.io/selected-node": {}}}}}, {"manager": "kube-controller-manager", "operation": "Update", "apiVersion": "v1", "time": "2021-08-01T10:20:28Z", "fieldsType": "FieldsV1", "fieldsV1": {"f:metadata": {"f:annotations": {"f:pv.kubernetes.io/bind-completed": {}, "f:pv.kubernetes.io/bound-by-controller": {}, "f:volume.beta.kubernetes.io/storage-provisioner": {}}, "f:labels": {".": {}, "f:app.kubernetes.io/component": {}, "f:app.kubernetes.io/name": {}, "f:app.kubernetes.io/part-of": {}}, "f:ownerReferences": {".": {}, "k:{\"uid\":\"ea47ca4d-4331-455c-9091-1cd85e73d623\"}": {".": {}, "f:apiVersion": {}, "f:blockOwnerDeletion": {}, "f:controller": {}, "f:kind": {}, "f:name": {}, "f:uid": {}}}}, "f:spec": {"f:accessModes": {}, "f:resources": {"f:requests": {".": {}, "f:storage": {}}}, "f:volumeMode": {}, "f:volumeName": {}}, "f:status": {"f:accessModes": {}, "f:capacity": {".": {}, "f:storage": {}}, "f:phase": {}}}}]}, "spec": {"accessModes": ["ReadWriteOnce"], "resources": {"requests": {"storage": "10Gi"}}, "volumeName": "pvc-035970e5-2836-4e50-9084-3f404994c270", "storageClassName": "standard", "volumeMode": "Filesystem"}, "status": {"phase": "Bound", "accessModes": ["ReadWriteOnce"], "capacity": {"storage": "10Gi"}}}], "deployment": [{"metadata": {"name": "rabbitmq-operator", "namespace": "default", "selfLink": "/apis/apps/v1/namespaces/default/deployments/rabbitmq-operator", "uid": "2f419a76-89e3-44fd-be09-a826be146977", "resourceVersion": "1018", "generation": 1, "creationTimestamp": "2021-08-01T10:19:05Z", "labels": {"app.kubernetes.io/component": "rabbitmq-cluster-operator", "app.kubernetes.io/name": "rabbitmq-cluster-operator", "app.kubernetes.io/part-of": "rabbitmq"}, "annotations": {"deployment.kubernetes.io/revision": "1", "kubectl.kubernetes.io/last-applied-configuration": "{\"apiVersion\":\"apps/v1\",\"kind\":\"Deployment\",\"metadata\":{\"annotations\":{},\"labels\":{\"app.kubernetes.io/component\":\"rabbitmq-cluster-operator\",\"app.kubernetes.io/name\":\"rabbitmq-cluster-operator\",\"app.kubernetes.io/part-of\":\"rabbitmq\"},\"name\":\"rabbitmq-operator\",\"namespace\":\"default\"},\"spec\":{\"replicas\":1,\"selector\":{\"matchLabels\":{\"app.kubernetes.io/name\":\"rabbitmq-cluster-operator\",\"sonartag\":\"rabbitmq-operator\"}},\"template\":{\"metadata\":{\"labels\":{\"app.kubernetes.io/component\":\"rabbitmq-cluster-operator\",\"app.kubernetes.io/name\":\"rabbitmq-cluster-operator\",\"app.kubernetes.io/part-of\":\"rabbitmq\",\"sonartag\":\"rabbitmq-operator\"}},\"spec\":{\"containers\":[{\"command\":[\"/manager\"],\"env\":[{\"name\":\"OPERATOR_NAMESPACE\",\"valueFrom\":{\"fieldRef\":{\"fieldPath\":\"metadata.namespace\"}}},{\"name\":\"KUBERNETES_SERVICE_HOST\",\"value\":\"kind-control-plane\"},{\"name\":\"KUBERNETES_SERVICE_PORT\",\"value\":\"6443\"}],\"envFrom\":[{\"configMapRef\":{\"name\":\"sonar-testing-global-config\"}}],\"image\":\"laphets/rabbitmq-operator:obs-gap\",\"name\":\"operator\",\"ports\":[{\"containerPort\":9782,\"name\":\"metrics\",\"protocol\":\"TCP\"}],\"resources\":{\"limits\":{\"cpu\":\"200m\",\"memory\":\"500Mi\"},\"requests\":{\"cpu\":\"200m\",\"memory\":\"500Mi\"}}}],\"securityContext\":{\"fsGroup\":1000,\"runAsGroup\":1000,\"runAsUser\":1000},\"serviceAccountName\":\"rabbitmq-cluster-operator\",\"terminationGracePeriodSeconds\":10}}}}\n"}, "managedFields": [{"manager": "kubectl-client-side-apply", "operation": "Update", "apiVersion": "apps/v1", "time": "2021-08-01T10:19:05Z", "fieldsType": "FieldsV1", "fieldsV1": {"f:metadata": {"f:annotations": {".": {}, "f:kubectl.kubernetes.io/last-applied-configuration": {}}, "f:labels": {".": {}, "f:app.kubernetes.io/component": {}, "f:app.kubernetes.io/name": {}, "f:app.kubernetes.io/part-of": {}}}, "f:spec": {"f:progressDeadlineSeconds": {}, "f:replicas": {}, "f:revisionHistoryLimit": {}, "f:selector": {"f:matchLabels": {".": {}, "f:app.kubernetes.io/name": {}, "f:sonartag": {}}}, "f:strategy": {"f:rollingUpdate": {".": {}, "f:maxSurge": {}, "f:maxUnavailable": {}}, "f:type": {}}, "f:template": {"f:metadata": {"f:labels": {".": {}, "f:app.kubernetes.io/component": {}, "f:app.kubernetes.io/name": {}, "f:app.kubernetes.io/part-of": {}, "f:sonartag": {}}}, "f:spec": {"f:containers": {"k:{\"name\":\"operator\"}": {".": {}, "f:command": {}, "f:env": {".": {}, "k:{\"name\":\"KUBERNETES_SERVICE_HOST\"}": {".": {}, "f:name": {}, "f:value": {}}, "k:{\"name\":\"KUBERNETES_SERVICE_PORT\"}": {".": {}, "f:name": {}, "f:value": {}}, "k:{\"name\":\"OPERATOR_NAMESPACE\"}": {".": {}, "f:name": {}, "f:valueFrom": {".": {}, "f:fieldRef": {".": {}, "f:apiVersion": {}, "f:fieldPath": {}}}}}, "f:envFrom": {}, "f:image": {}, "f:imagePullPolicy": {}, "f:name": {}, "f:ports": {".": {}, "k:{\"containerPort\":9782,\"protocol\":\"TCP\"}": {".": {}, "f:containerPort": {}, "f:name": {}, "f:protocol": {}}}, "f:resources": {".": {}, "f:limits": {".": {}, "f:cpu": {}, "f:memory": {}}, "f:requests": {".": {}, "f:cpu": {}, "f:memory": {}}}, "f:terminationMessagePath": {}, "f:terminationMessagePolicy": {}}}, "f:dnsPolicy": {}, "f:restartPolicy": {}, "f:schedulerName": {}, "f:securityContext": {".": {}, "f:fsGroup": {}, "f:runAsGroup": {}, "f:runAsUser": {}}, "f:serviceAccount": {}, "f:serviceAccountName": {}, "f:terminationGracePeriodSeconds": {}}}}}}, {"manager": "kube-controller-manager", "operation": "Update", "apiVersion": "apps/v1", "time": "2021-08-01T10:19:08Z", "fieldsType": "FieldsV1", "fieldsV1": {"f:metadata": {"f:annotations": {"f:deployment.kubernetes.io/revision": {}}}, "f:status": {"f:availableReplicas": {}, "f:conditions": {".": {}, "k:{\"type\":\"Available\"}": {".": {}, "f:lastTransitionTime": {}, "f:lastUpdateTime": {}, "f:message": {}, "f:reason": {}, "f:status": {}, "f:type": {}}, "k:{\"type\":\"Progressing\"}": {".": {}, "f:lastTransitionTime": {}, "f:lastUpdateTime": {}, "f:message": {}, "f:reason": {}, "f:status": {}, "f:type": {}}}, "f:observedGeneration": {}, "f:readyReplicas": {}, "f:replicas": {}, "f:updatedReplicas": {}}}}]}, "spec": {"replicas": 1, "selector": {"matchLabels": {"app.kubernetes.io/name": "rabbitmq-cluster-operator", "sonartag": "rabbitmq-operator"}}, "template": {"metadata": {"creationTimestamp": null, "labels": {"app.kubernetes.io/component": "rabbitmq-cluster-operator", "app.kubernetes.io/name": "rabbitmq-cluster-operator", "app.kubernetes.io/part-of": "rabbitmq", "sonartag": "rabbitmq-operator"}}, "spec": {"containers": [{"name": "operator", "image": "laphets/rabbitmq-operator:obs-gap", "command": ["/manager"], "ports": [{"name": "metrics", "containerPort": 9782, "protocol": "TCP"}], "envFrom": [{"configMapRef": {"name": "sonar-testing-global-config"}}], "env": [{"name": "OPERATOR_NAMESPACE", "valueFrom": {"fieldRef": {"apiVersion": "v1", "fieldPath": "metadata.namespace"}}}, {"name": "KUBERNETES_SERVICE_HOST", "value": "kind-control-plane"}, {"name": "KUBERNETES_SERVICE_PORT", "value": "6443"}], "resources": {"limits": {"cpu": "200m", "memory": "500Mi"}, "requests": {"cpu": "200m", "memory": "500Mi"}}, "terminationMessagePath": "/dev/termination-log", "terminationMessagePolicy": "File", "imagePullPolicy": "IfNotPresent"}], "restartPolicy": "Always", "terminationGracePeriodSeconds": 10, "dnsPolicy": "ClusterFirst", "serviceAccountName": "rabbitmq-cluster-operator", "serviceAccount": "rabbitmq-cluster-operator", "securityContext": {"runAsUser": 1000, "runAsGroup": 1000, "fsGroup": 1000}, "schedulerName": "default-scheduler"}}, "strategy": {"type": "RollingUpdate", "rollingUpdate": {"maxUnavailable": "25%", "maxSurge": "25%"}}, "revisionHistoryLimit": 10, "progressDeadlineSeconds": 600}, "status": {"observedGeneration": 1, "replicas": 1, "updatedReplicas": 1, "readyReplicas": 1, "availableReplicas": 1, "conditions": [{"type": "Available", "status": "True", "lastUpdateTime": "2021-08-01T10:19:08Z", "lastTransitionTime": "2021-08-01T10:19:08Z", "reason": "MinimumReplicasAvailable", "message": "Deployment has minimum availability."}, {"type": "Progressing", "status": "True", "lastUpdateTime": "2021-08-01T10:19:08Z", "lastTransitionTime": "2021-08-01T10:19:05Z", "reason": "NewReplicaSetAvailable", "message": "ReplicaSet \"rabbitmq-operator-774b86b97d\" has successfully progressed."}]}}], "statefulset": [{"metadata": {"name": "rabbitmq-cluster-server", "namespace": "default", "selfLink": "/apis/apps/v1/namespaces/default/statefulsets/rabbitmq-cluster-server", "uid": "757c5705-804d-4916-b633-1a1555612182", "resourceVersion": "1712", "generation": 2, "creationTimestamp": "2021-08-01T10:19:21Z", "labels": {"app.kubernetes.io/component": "rabbitmq", "app.kubernetes.io/name": "rabbitmq-cluster", "app.kubernetes.io/part-of": "rabbitmq"}, "ownerReferences": [{"apiVersion": "rabbitmq.com/v1beta1", "kind": "RabbitmqCluster", "name": "rabbitmq-cluster", "uid": "ea47ca4d-4331-455c-9091-1cd85e73d623", "controller": true, "blockOwnerDeletion": true}], "managedFields": [{"manager": "manager", "operation": "Update", "apiVersion": "apps/v1", "time": "2021-08-01T10:20:26Z", "fieldsType": "FieldsV1", "fieldsV1": {"f:metadata": {"f:labels": {".": {}, "f:app.kubernetes.io/component": {}, "f:app.kubernetes.io/name": {}, "f:app.kubernetes.io/part-of": {}}, "f:ownerReferences": {".": {}, "k:{\"uid\":\"ea47ca4d-4331-455c-9091-1cd85e73d623\"}": {".": {}, "f:apiVersion": {}, "f:blockOwnerDeletion": {}, "f:controller": {}, "f:kind": {}, "f:name": {}, "f:uid": {}}}}, "f:spec": {"f:podManagementPolicy": {}, "f:replicas": {}, "f:revisionHistoryLimit": {}, "f:selector": {"f:matchLabels": {".": {}, "f:app.kubernetes.io/name": {}}}, "f:serviceName": {}, "f:template": {"f:metadata": {"f:annotations": {".": {}, "f:prometheus.io/port": {}, "f:prometheus.io/scrape": {}}, "f:labels": {".": {}, "f:app.kubernetes.io/component": {}, "f:app.kubernetes.io/name": {}, "f:app.kubernetes.io/part-of": {}}}, "f:spec": {"f:automountServiceAccountToken": {}, "f:containers": {"k:{\"name\":\"rabbitmq\"}": {".": {}, "f:env": {".": {}, "k:{\"name\":\"K8S_HOSTNAME_SUFFIX\"}": {".": {}, "f:name": {}, "f:value": {}}, "k:{\"name\":\"K8S_SERVICE_NAME\"}": {".": {}, "f:name": {}, "f:value": {}}, "k:{\"name\":\"MY_POD_NAME\"}": {".": {}, "f:name": {}, "f:valueFrom": {".": {}, "f:fieldRef": {".": {}, "f:apiVersion": {}, "f:fieldPath": {}}}}, "k:{\"name\":\"MY_POD_NAMESPACE\"}": {".": {}, "f:name": {}, "f:valueFrom": {".": {}, "f:fieldRef": {".": {}, "f:apiVersion": {}, "f:fieldPath": {}}}}, "k:{\"name\":\"RABBITMQ_ENABLED_PLUGINS_FILE\"}": {".": {}, "f:name": {}, "f:value": {}}, "k:{\"name\":\"RABBITMQ_NODENAME\"}": {".": {}, "f:name": {}, "f:value": {}}, "k:{\"name\":\"RABBITMQ_USE_LONGNAME\"}": {".": {}, "f:name": {}, "f:value": {}}}, "f:image": {}, "f:imagePullPolicy": {}, "f:lifecycle": {".": {}, "f:preStop": {".": {}, "f:exec": {".": {}, "f:command": {}}}}, "f:name": {}, "f:ports": {".": {}, "k:{\"containerPort\":4369,\"protocol\":\"TCP\"}": {".": {}, "f:containerPort": {}, "f:name": {}, "f:protocol": {}}, "k:{\"containerPort\":5672,\"protocol\":\"TCP\"}": {".": {}, "f:containerPort": {}, "f:name": {}, "f:protocol": {}}, "k:{\"containerPort\":15672,\"protocol\":\"TCP\"}": {".": {}, "f:containerPort": {}, "f:name": {}, "f:protocol": {}}, "k:{\"containerPort\":15692,\"protocol\":\"TCP\"}": {".": {}, "f:containerPort": {}, "f:name": {}, "f:protocol": {}}}, "f:readinessProbe": {".": {}, "f:failureThreshold": {}, "f:initialDelaySeconds": {}, "f:periodSeconds": {}, "f:successThreshold": {}, "f:tcpSocket": {".": {}, "f:port": {}}, "f:timeoutSeconds": {}}, "f:resources": {".": {}, "f:limits": {".": {}, "f:cpu": {}, "f:memory": {}}, "f:requests": {".": {}, "f:cpu": {}, "f:memory": {}}}, "f:terminationMessagePath": {}, "f:terminationMessagePolicy": {}, "f:volumeMounts": {".": {}, "k:{\"mountPath\":\"/etc/pod-info/\"}": {".": {}, "f:mountPath": {}, "f:name": {}}, "k:{\"mountPath\":\"/etc/rabbitmq/conf.d/10-operatorDefaults.conf\"}": {".": {}, "f:mountPath": {}, "f:name": {}, "f:subPath": {}}, "k:{\"mountPath\":\"/etc/rabbitmq/conf.d/11-default_user.conf\"}": {".": {}, "f:mountPath": {}, "f:name": {}, "f:subPath": {}}, "k:{\"mountPath\":\"/etc/rabbitmq/conf.d/90-userDefinedConfiguration.conf\"}": {".": {}, "f:mountPath": {}, "f:name": {}, "f:subPath": {}}, "k:{\"mountPath\":\"/operator\"}": {".": {}, "f:mountPath": {}, "f:name": {}}, "k:{\"mountPath\":\"/var/lib/rabbitmq/\"}": {".": {}, "f:mountPath": {}, "f:name": {}}, "k:{\"mountPath\":\"/var/lib/rabbitmq/mnesia/\"}": {".": {}, "f:mountPath": {}, "f:name": {}}}}}, "f:dnsPolicy": {}, "f:initContainers": {".": {}, "k:{\"name\":\"setup-container\"}": {".": {}, "f:command": {}, "f:image": {}, "f:imagePullPolicy": {}, "f:name": {}, "f:resources": {".": {}, "f:limits": {".": {}, "f:cpu": {}, "f:memory": {}}, "f:requests": {".": {}, "f:cpu": {}, "f:memory": {}}}, "f:securityContext": {".": {}, "f:capabilities": {".": {}, "f:drop": {}}, "f:runAsUser": {}}, "f:terminationMessagePath": {}, "f:terminationMessagePolicy": {}, "f:volumeMounts": {".": {}, "k:{\"mountPath\":\"/operator\"}": {".": {}, "f:mountPath": {}, "f:name": {}}, "k:{\"mountPath\":\"/tmp/default_user.conf\"}": {".": {}, "f:mountPath": {}, "f:name": {}, "f:subPath": {}}, "k:{\"mountPath\":\"/tmp/erlang-cookie-secret/\"}": {".": {}, "f:mountPath": {}, "f:name": {}}, "k:{\"mountPath\":\"/tmp/rabbitmq-plugins/\"}": {".": {}, "f:mountPath": {}, "f:name": {}}, "k:{\"mountPath\":\"/var/lib/rabbitmq/\"}": {".": {}, "f:mountPath": {}, "f:name": {}}, "k:{\"mountPath\":\"/var/lib/rabbitmq/mnesia/\"}": {".": {}, "f:mountPath": {}, "f:name": {}}}}}, "f:restartPolicy": {}, "f:schedulerName": {}, "f:securityContext": {".": {}, "f:fsGroup": {}, "f:runAsGroup": {}, "f:runAsUser": {}}, "f:serviceAccount": {}, "f:serviceAccountName": {}, "f:terminationGracePeriodSeconds": {}, "f:topologySpreadConstraints": {".": {}, "k:{\"topologyKey\":\"topology.kubernetes.io/zone\",\"whenUnsatisfiable\":\"ScheduleAnyway\"}": {".": {}, "f:labelSelector": {".": {}, "f:matchLabels": {".": {}, "f:app.kubernetes.io/name": {}}}, "f:maxSkew": {}, "f:topologyKey": {}, "f:whenUnsatisfiable": {}}}, "f:volumes": {".": {}, "k:{\"name\":\"erlang-cookie-secret\"}": {".": {}, "f:name": {}, "f:secret": {".": {}, "f:defaultMode": {}, "f:secretName": {}}}, "k:{\"name\":\"plugins-conf\"}": {".": {}, "f:configMap": {".": {}, "f:defaultMode": {}, "f:name": {}}, "f:name": {}}, "k:{\"name\":\"pod-info\"}": {".": {}, "f:downwardAPI": {".": {}, "f:defaultMode": {}, "f:items": {}}, "f:name": {}}, "k:{\"name\":\"rabbitmq-confd\"}": {".": {}, "f:name": {}, "f:projected": {".": {}, "f:defaultMode": {}, "f:sources": {}}}, "k:{\"name\":\"rabbitmq-erlang-cookie\"}": {".": {}, "f:emptyDir": {}, "f:name": {}}, "k:{\"name\":\"rabbitmq-plugins\"}": {".": {}, "f:emptyDir": {}, "f:name": {}}}}}, "f:updateStrategy": {"f:rollingUpdate": {".": {}, "f:partition": {}}, "f:type": {}}, "f:volumeClaimTemplates": {}}}}, {"manager": "kube-controller-manager", "operation": "Update", "apiVersion": "apps/v1", "time": "2021-08-01T10:21:13Z", "fieldsType": "FieldsV1", "fieldsV1": {"f:status": {"f:collisionCount": {}, "f:currentReplicas": {}, "f:currentRevision": {}, "f:observedGeneration": {}, "f:readyReplicas": {}, "f:replicas": {}, "f:updateRevision": {}, "f:updatedReplicas": {}}}}]}, "spec": {"replicas": 2, "selector": {"matchLabels": {"app.kubernetes.io/name": "rabbitmq-cluster"}}, "template": {"metadata": {"creationTimestamp": null, "labels": {"app.kubernetes.io/component": "rabbitmq", "app.kubernetes.io/name": "rabbitmq-cluster", "app.kubernetes.io/part-of": "rabbitmq"}, "annotations": {"prometheus.io/port": "15692", "prometheus.io/scrape": "true"}}, "spec": {"volumes": [{"name": "plugins-conf", "configMap": {"name": "rabbitmq-cluster-plugins-conf", "defaultMode": 420}}, {"name": "rabbitmq-confd", "projected": {"sources": [{"secret": {"name": "rabbitmq-cluster-default-user", "items": [{"key": "default_user.conf", "path": "default_user.conf"}]}}, {"configMap": {"name": "rabbitmq-cluster-server-conf", "items": [{"key": "operatorDefaults.conf", "path": "operatorDefaults.conf"}, {"key": "userDefinedConfiguration.conf", "path": "userDefinedConfiguration.conf"}]}}], "defaultMode": 420}}, {"name": "rabbitmq-erlang-cookie", "emptyDir": {}}, {"name": "erlang-cookie-secret", "secret": {"secretName": "rabbitmq-cluster-erlang-cookie", "defaultMode": 420}}, {"name": "rabbitmq-plugins", "emptyDir": {}}, {"name": "pod-info", "downwardAPI": {"items": [{"path": "skipPreStopChecks", "fieldRef": {"apiVersion": "v1", "fieldPath": "metadata.labels['skipPreStopChecks']"}}], "defaultMode": 420}}], "initContainers": [{"name": "setup-container", "image": "rabbitmq:3.8.12-management", "command": ["sh", "-c", "cp /tmp/erlang-cookie-secret/.erlang.cookie /var/lib/rabbitmq/.erlang.cookie && chown 999:999 /var/lib/rabbitmq/.erlang.cookie && chmod 600 /var/lib/rabbitmq/.erlang.cookie ; cp /tmp/rabbitmq-plugins/enabled_plugins /operator/enabled_plugins && chown 999:999 /operator/enabled_plugins ; chown 999:999 /var/lib/rabbitmq/mnesia/ ; echo '[default]' > /var/lib/rabbitmq/.rabbitmqadmin.conf && sed -e 's/default_user/username/' -e 's/default_pass/password/' /tmp/default_user.conf >> /var/lib/rabbitmq/.rabbitmqadmin.conf && chown 999:999 /var/lib/rabbitmq/.rabbitmqadmin.conf && chmod 600 /var/lib/rabbitmq/.rabbitmqadmin.conf"], "resources": {"limits": {"cpu": "100m", "memory": "500Mi"}, "requests": {"cpu": "100m", "memory": "500Mi"}}, "volumeMounts": [{"name": "plugins-conf", "mountPath": "/tmp/rabbitmq-plugins/"}, {"name": "rabbitmq-erlang-cookie", "mountPath": "/var/lib/rabbitmq/"}, {"name": "erlang-cookie-secret", "mountPath": "/tmp/erlang-cookie-secret/"}, {"name": "rabbitmq-plugins", "mountPath": "/operator"}, {"name": "persistence", "mountPath": "/var/lib/rabbitmq/mnesia/"}, {"name": "rabbitmq-confd", "mountPath": "/tmp/default_user.conf", "subPath": "default_user.conf"}], "terminationMessagePath": "/dev/termination-log", "terminationMessagePolicy": "File", "imagePullPolicy": "IfNotPresent", "securityContext": {"capabilities": {"drop": ["FSETID", "KILL", "SETGID", "SETUID", "SETPCAP", "NET_BIND_SERVICE", "NET_RAW", "SYS_CHROOT", "MKNOD", "AUDIT_WRITE", "SETFCAP"]}, "runAsUser": 0}}], "containers": [{"name": "rabbitmq", "image": "rabbitmq:3.8.12-management", "ports": [{"name": "epmd", "containerPort": 4369, "protocol": "TCP"}, {"name": "amqp", "containerPort": 5672, "protocol": "TCP"}, {"name": "management", "containerPort": 15672, "protocol": "TCP"}, {"name": "prometheus", "containerPort": 15692, "protocol": "TCP"}], "env": [{"name": "MY_POD_NAME", "valueFrom": {"fieldRef": {"apiVersion": "v1", "fieldPath": "metadata.name"}}}, {"name": "MY_POD_NAMESPACE", "valueFrom": {"fieldRef": {"apiVersion": "v1", "fieldPath": "metadata.namespace"}}}, {"name": "RABBITMQ_ENABLED_PLUGINS_FILE", "value": "/operator/enabled_plugins"}, {"name": "K8S_SERVICE_NAME", "value": "rabbitmq-cluster-nodes"}, {"name": "RABBITMQ_USE_LONGNAME", "value": "true"}, {"name": "RABBITMQ_NODENAME", "value": "rabbit@$(MY_POD_NAME).$(K8S_SERVICE_NAME).$(MY_POD_NAMESPACE)"}, {"name": "K8S_HOSTNAME_SUFFIX", "value": ".$(K8S_SERVICE_NAME).$(MY_POD_NAMESPACE)"}], "resources": {"limits": {"cpu": "2", "memory": "2Gi"}, "requests": {"cpu": "1", "memory": "2Gi"}}, "volumeMounts": [{"name": "rabbitmq-erlang-cookie", "mountPath": "/var/lib/rabbitmq/"}, {"name": "persistence", "mountPath": "/var/lib/rabbitmq/mnesia/"}, {"name": "rabbitmq-plugins", "mountPath": "/operator"}, {"name": "rabbitmq-confd", "mountPath": "/etc/rabbitmq/conf.d/10-operatorDefaults.conf", "subPath": "operatorDefaults.conf"}, {"name": "rabbitmq-confd", "mountPath": "/etc/rabbitmq/conf.d/11-default_user.conf", "subPath": "default_user.conf"}, {"name": "rabbitmq-confd", "mountPath": "/etc/rabbitmq/conf.d/90-userDefinedConfiguration.conf", "subPath": "userDefinedConfiguration.conf"}, {"name": "pod-info", "mountPath": "/etc/pod-info/"}], "readinessProbe": {"tcpSocket": {"port": "amqp"}, "initialDelaySeconds": 10, "timeoutSeconds": 5, "periodSeconds": 10, "successThreshold": 1, "failureThreshold": 3}, "lifecycle": {"preStop": {"exec": {"command": ["/bin/bash", "-c", "if [ ! -z \"$(cat /etc/pod-info/skipPreStopChecks)\" ]; then exit 0; fi; rabbitmq-upgrade await_online_quorum_plus_one -t 604800; rabbitmq-upgrade await_online_synchronized_mirror -t 604800; rabbitmq-upgrade drain -t 604800"]}}}, "terminationMessagePath": "/dev/termination-log", "terminationMessagePolicy": "File", "imagePullPolicy": "IfNotPresent"}], "restartPolicy": "Always", "terminationGracePeriodSeconds": 604800, "dnsPolicy": "ClusterFirst", "serviceAccountName": "rabbitmq-cluster-server", "serviceAccount": "rabbitmq-cluster-server", "automountServiceAccountToken": true, "securityContext": {"runAsUser": 999, "runAsGroup": 999, "fsGroup": 999}, "schedulerName": "default-scheduler", "topologySpreadConstraints": [{"maxSkew": 1, "topologyKey": "topology.kubernetes.io/zone", "whenUnsatisfiable": "ScheduleAnyway", "labelSelector": {"matchLabels": {"app.kubernetes.io/name": "rabbitmq-cluster"}}}]}}, "volumeClaimTemplates": [{"kind": "PersistentVolumeClaim", "apiVersion": "v1", "metadata": {"name": "persistence", "namespace": "default", "creationTimestamp": null, "labels": {"app.kubernetes.io/component": "rabbitmq", "app.kubernetes.io/name": "rabbitmq-cluster", "app.kubernetes.io/part-of": "rabbitmq"}, "ownerReferences": [{"apiVersion": "rabbitmq.com/v1beta1", "kind": "RabbitmqCluster", "name": "rabbitmq-cluster", "uid": "ea47ca4d-4331-455c-9091-1cd85e73d623", "controller": true, "blockOwnerDeletion": false}]}, "spec": {"accessModes": ["ReadWriteOnce"], "resources": {"requests": {"storage": "10Gi"}}, "volumeMode": "Filesystem"}, "status": {"phase": "Pending"}}], "serviceName": "rabbitmq-cluster-nodes", "podManagementPolicy": "Parallel", "updateStrategy": {"type": "RollingUpdate", "rollingUpdate": {"partition": 0}}, "revisionHistoryLimit": 10}, "status": {"observedGeneration": 2, "replicas": 2, "readyReplicas": 2, "currentReplicas": 2, "updatedReplicas": 2, "currentRevision": "rabbitmq-cluster-server-5f8b8665fb", "updateRevision": "rabbitmq-cluster-server-5f8b8665fb", "collisionCount": 0}}]}